<!DOCTYPE html>
<html>
<head>
    <title>Keyboard Events</title>
    <style>
        body { margin: 0; }
        #keyboard-area {
            width: 100%;
            height: 100px;
            border: 1px solid #ccc;
            padding: 10px;
            font-family: monospace;
            text-align: center;
            cursor: pointer;
        }
    </style>
    <script src="https://unpkg.com/@streamlit/component-lib@1.4.0/dist/streamlit-component-lib.js"></script>
</head>
<body>
    <div id="keyboard-area" tabindex="0">Click here to capture keyboard events</div>
    <script>
        const area = document.getElementById('keyboard-area');
        const pressedKeys = new Set();

        function sendToStreamlit() {
            console.log("sendToStreamlit:", Array.from(pressedKeys));
            window.Streamlit.setComponentValue(Array.from(pressedKeys));
        }

        area.addEventListener('keydown', (event) => {
            event.preventDefault();
            const key = event.key.toUpperCase();
            console.log("keydown:", key);
            pressedKeys.add(key);
            sendToStreamlit();
            area.textContent = `Active keys: ${Array.from(pressedKeys).join(', ')}`;
        });

        area.addEventListener('keyup', (event) => {
            event.preventDefault();
            const key = event.key.toUpperCase();
            console.log("keyup:", key);
            pressedKeys.delete(key);
            sendToStreamlit();
            area.textContent = pressedKeys.size ? 
                `Active keys: ${Array.from(pressedKeys).join(', ')}` :
                'Click here to capture keyboard events';
        });

        area.addEventListener('focus', () => {
            console.log("focus");
            area.textContent = 'Ready to capture keyboard events';
        });

        area.addEventListener('blur', () => {
            console.log("blur");
            area.textContent = 'Click here to capture keyboard events';
        });

        console.log("Component loaded");
        window.Streamlit.setComponentReady();
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <style>
        #keyboard-area {
            width: 100%;
            height: 100px;
            border: 1px solid #ccc;
            padding: 10px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="keyboard-area" tabindex="0">Click here to capture keyboard events</div>
    <script>
        const area = document.getElementById('keyboard-area');
        const pressedKeys = new Set();

        // Streamlitとの通信を設定
        function sendToStreamlit(data) {
            window.Streamlit.setComponentValue(data);
        }

        // キー押下イベントの処理
        area.addEventListener('keydown', (event) => {
            event.preventDefault();
            pressedKeys.add(event.key.toUpperCase());
            sendToStreamlit(Array.from(pressedKeys));
            area.textContent = `Pressed keys: ${Array.from(pressedKeys).join(', ')}`;
        });

        // キーリリースイベントの処理
        area.addEventListener('keyup', (event) => {
            event.preventDefault();
            pressedKeys.delete(event.key.toUpperCase());
            sendToStreamlit(Array.from(pressedKeys));
            area.textContent = `Pressed keys: ${Array.from(pressedKeys).join(', ')}`;
        });

        // フォーカス時の表示
        area.addEventListener('focus', () => {
            area.textContent = 'Capturing keyboard events...';
        });

        // フォーカス解除時の表示
        area.addEventListener('blur', () => {
            area.textContent = 'Click here to capture keyboard events';
        });

        // Streamlitに初期化完了を通知
        window.Streamlit.setComponentReady();
    </script>
</body>
</html>
